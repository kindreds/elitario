import React, { useEffect, useState } from 'react'
import d from 'next/dynamic'
import Head from 'next/head'

// Librerias de Terceros
import { useDisclosure } from '@chakra-ui/hooks'
import { useInView } from 'react-intersection-observer'

// Componentes
import Header from '@/components/Header'
import MobileNav from '@/components/MobileNav'
import BrandStack from '@/components/BrandStack'
import HeroSlider from '@/components/HeroSlider'

// Importaciones dinamicas
const Landing = d(() => import('@/sections/Landing'))
const Sidebar = d(() => import('@/components/Sidebar'))

const Home = () => {
  const [loadChunk, setLoadChunk] = useState(false)
  const { isOpen, onClose, onOpen } = useDisclosure()
  const { ref, inView } = useInView({ rootMargin: '80px' })

  useEffect(() => {
    if (isOpen || inView) setLoadChunk(true)
  }, [isOpen, inView])

  return (
    <>
      <Head>
        <title>Elitario</title>
        <link rel="icon" href="/favicon.ico" />
        <meta name="description" content="Generated by create next app" />
      </Head>

      {/* FIRTS LOAD */}
      <Header />
      <MobileNav {...{ onOpen }} />
      <HeroSlider />
      <BrandStack />

      {/* LOAD LATER */}
      <div ref={ref}>{loadChunk ? <Landing /> : null}</div>

      {loadChunk ? <Sidebar {...{ isOpen, onClose }} /> : null}
    </>
  )
}

export default Home
